# Message Format Spec

## TODO: go through this, eliminate what we don't actually need/use

## The server connector parses raw events into this format and barfs them on core

```javascript

incomingMessage = {
  type: 'incomingMessage',
  version: 1, // message format version
  origModule: 'irc', // the module that first sent this message
  toModule: 'parser', // who to send the message to
  platform: 'irc', // [irc,matrix,etc]
  server: 'irc.foo.bar', // [some.fqdn]
  channel: '#channel', // [#channel,@person]
  from: 'SomeNick', // [string]
  text: '.echo foo bar', // [string]
  messageType: 'chanmsg', // [chanmsg,privmsg,notice,srvmsg]
  ext: { // optional extended capabilities
    raw: { // the raw event as delivered by the irc connector
      type: 'privmsg',
      nick: 'SomeNick',
      ident: 'SomeNick',
      hostname: 'SomeIdentMask',
      target: '#channel',
      message: '.echo foo bar',
      tags: {}
    }
  }
}

```

## The modules do the thing and pass outgoing messages to core like this

```javascript

outgoingMessage = {
  type: 'outgoingMessage',
  version: 1, // message format version
  origModule: 'echo' // the module that first sent this message
  toModule: 'irc', // who to send the message to
  server: 'irc.foo.bar', // [some.fqdn]
  to: '#channel', // [#channel,@person]
  text: [ // plain text strings supported too
      {
        color: 'red', // [red,blue,green,etc]
        style: 'bold', // [bold,italic,inverted]
        text: 'foo ' // add your own whitespace
      },
      {
        text: 'bar'
      }
    ],
  messageType: 'chanmsg', // [chanmsg,privmsg,notice,raw]
  raw: 'null', // some raw client event to send
}

```

## Control messages. Generated by modules and sent to core

There are *many* possible variations of this command. If in doubt, read the source for the module you're sending commands to.

```javascript

controlMessage = {
  type: 'controlMessage',
  version: 1,
  origModule: 'admin' // the module that first sent this message
  toModule: 'core', // who to send the message to
  command: 'restartModule', // the command
  args: 'echo', // args
  notify: 'admin', // who to send any command output to
  ext: { // optional extended capabilities
    kill: 'true' // sigkill the module instead of sigterm
  }
}

controlMessage = {
  type: 'controlMessage',
  version: 1,
  origModule: 'admin' // the module that first sent this message
  toModule: 'irc', // who to send the message to
  command: 'reconnect',
  args: 'irc.foo.bar',
  notify: 'watchdog',
  ext: {
    kill: 'true' // kill the client process instead of just reconnecting
  }
}

// etc etc etc.... you get the idea
// TODO doc more of this

```

## Notification messages - kinda like callbacks but not really

```javascript

common.notify_old(message, {
  command ': '
  stopModule ',
  'args': message.args,
  'text': `Module ${message.args} does not exist or is not loaded`,
  'result': true,
  'error': new Error(`[stopModule] Module ${message.args} does not exist or is not loaded`)
  'ext': {
    'text': [{
        'text': 'Module ['
      },
      {
        'text': message.args,
        'color': 'blue'
      },
      {
        'text': '] does not exist or is not loaded'
      }
    ],
  }
});

```
